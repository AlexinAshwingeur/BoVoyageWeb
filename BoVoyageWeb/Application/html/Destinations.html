<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
          crossorigin="anonymous" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU"
          crossorigin="anonymous" />
    <link rel="stylesheet" href="/Application/css/style.css" />
    
    

    <title>Liste des Destinations</title>
</head>
<body>
    <nav class="navbar navbar-expand-sm navbar-dark bg-dark">
        <a class="navbar-brand" href="/"><i class="fas fa-check-double"></i> BoVoyage</a>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="/Application/html/Voyages.html">Gestion Voyage <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link " href="/application/html/Clients.html">Gestion Client</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <h1>
            Liste des Destinations
        </h1>
        <div style="margin-bottom:25px;">
            <a href="/Application/html/CreerDestination.html" class="btn btn-primary btn-sm">Créer une Destination</a>
            <a href="/Application/html/Voyages.html" class="btn btn-info btn-sm">Liste des Voyages</a>
            <a href="/Application/html/AgencesVoyages.html" class="btn btn-primary btn-sm">Liste des Agences de Voyage</a>
        </div>
        <div id="listeDestinations">

        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script src="/Application/js/JavaScript.js"></script>
    <script>
        function getDestinations() {
            var divListeDestinations = $('#listeDestinations');
            setLoader(divListeDestinations);
            $.ajax({
                url: '/api/destinations',
                success: function (destinations) {
                    divListeDestinations.empty();
                    if (destinations.count > 0) {
                        for (destination of destinations) {
                            var divDestination = $('<div class="Destination"></div>');
                            divDestination.attr("data-id", destination.ID);

                            var buttonDelete = $('<button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button>');
                            buttonDelete.on('click', function () {
                                // Affichage d'une confirmation
                                $.bsAlert.confirmTitle = 'Suppression';
                                $.bsAlert.closeDisplay = 'Non';
                                $.bsAlert.sureDisplay = 'Oui';
                                $.bsAlert.confirm("Es-tu sûr?", () => {
                                    var div = $(this).closest(".Destination");
                                    var idDestination = div.attr("data-id");
                                    SupprimerDestination(idDestination, div);
                                });
                            });
                            divDestination.append($('<label></label>').text(Destination.Continent));
                            divDestination.append(buttonDelete);
                            divListeDestinations.append(divDestination);
                        }
                    } else {
                        divListeDestinations.append($('<p class="lead">Aucune destination pour le moment...</p>'));
                    }
                },
            });
        }


        $(document).ready(getDestinations);





                //// fonction pour charger la liste des destinations utilisant le GET du controller Destinations
                //function LoadDestinations() {
                //    $.ajax({
                //        url: '/api/Destinations',
                //        success: function (destinations) {

                //            // Avec JQuery
                //            var divlisteDestinations= $('#listeDestinations');
                //            divlisteDestinations.empty();
                //            for (var destination of destinations) {
                //                var divDestination= $('<div class="Liste Destinations"></div>');
                //                RemplirDivDestinations(divDestination, destination);
                //                divlisteDestinations.append(divDestination);
                //            }
                //        }
                //    });
                //}

                //// fonction pour remplir la div Destination
                //function RemplirDivDestination(divDestination, destination) {
                //    divDestination.empty();
                //    divDestiantion.data('id', destination.id);
                //    divDestination.append($('<span id="Continent-span"></span>').text(destination.Continent));
                //    //divDestination.append($('<span id="Pays-span"></span>').text(destination.Pays));
                //    //divDestination.append($('<span id="Région-span"></span>').text(destination.Region));
                //    //divDestination.append($('<span id="Description-span></span>').text(destination.Description));

                //    //Bouton supprimer Destination
                //    var buttonDelete = $('<button id="DeleteButton" class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button>');
                //    buttonDelete.on('click', function () {
                //        $.bsAlert.confirmTitle = 'Suppression';
                //        $.bsAlert.closeDisplay = 'Non';
                //        $.bsAlert.sureDisplay = 'Oui';
                //        $.bsAlert.confirm("Etes-vous sûr de vouloir supprimer le voyage ?", () => {
                //            var idVoyage= $(this).closest(".Destination").data('id');
                //            Supprimer(idVoyage);
                //        });
                //    });
                //    divVoyage.append(buttonDelete);

                //    ////Bouton modifier destination
                //    var buttonModify = $('<button id="ModifyButton" class="btn btn-warning btn-sm"><i class="fas fa-pen"></i></button>')
                //    buttonModify.on('click', function () {
                //        Modifier($(this));
                //    });
                //    divDestination.append(buttonModify);
                //}

                ////Fonction pour modifier une destination
                //function Modifier(bouton) {
                //    var div = bouton.closest('.Destination');
                //    var spanContinent = div.find('#Continent-span');
                //    var spanPays= div.find('#Pays-span');
                //    var spanRegion= div.find('#Region-span');
                //    var spanDescription= div.find('#Description-span');
                //    var  continent = spanContinent.text();
                //    var  pays= spanPays.text();
                //    var  region= spanRegion.text();
                //    var  description = spanDescription.text();
                //    div.data('continent', continent); //stockage du continent dans le div en cas d'annulation
                //    div.data('pays', pays); //stockage du pays dans le div en cas d'annulation
                //    div.data('region', region); //stockage de la région dans le div en cas d'annulation
                //    div.data('description', description); //stockage de la description dans le div en cas d'annulation
                //    div.empty();
                //    var inputContinent = $('<input type="text"/>').val(spanContinent.text());
                //    var inputPays= $('<input type="text"/>').val(spanPays.text());
                //    var inputRegion= $('<input type="text"/>').val(spanRegion.text());
                //    var inputDescription= $('<input type="text"/>').val(spanDescription.text());
                //    div.append(inputContinent);
                //    div.append(inputPays);
                //    div.append(inputRegion);
                //    div.append(inputDescription);
                //    input.focus();
                //    input.select();
                //    input.on('keyup', function (event) {
                //        var divDestination = $(this).closest('.Destination');
                //        switch (event.which) {
                //            case 13:/*ENTER*/
                //                EnregistrerModification(divDestination);
                //                break;
                //            case 27:/*ESCAPE*/
                //                AnnulerModification(divDestination);
                //                break;
                //        }
                //    });
                //    var discardButton = $('<button class="btn btn-secondary btn-sm">Annuler</button>');
                //    discardButton.on('click', function () {
                //        let divDestination= $(this).closest('.Destination');
                //        AnnulerModification(divDestination);
                //    });
                //    div.append(discardButton);
                //    var SaveButton2 = $('<button class="btn btn-primary btn-sm">Enregister</button>');
                //    div.append(SaveButton2);
                //    SaveButton2.on('click', function () {
                //        EnregistrerModification($(this).closest('.Destination'));
                //    });
                //}

                //// fonction pour supprimer une destination
                //function Supprimer(idDestination) {
                //    $.ajax({
                //        type: 'DELETE',
                //        url: '/api/Destinations/' + idDestination,
                //        success: function () {
                //            LoadDestinations();
                //        },
                //        error: function () {
                //            alert('Impossible de supprimer. Peut-être la destination est elle liée à un voyage?');
                //        }
                //    });
                //}

                ////fonction pour annuler une modification sur destination
                //function AnnulerModification(divDestination) {
                //    let idDestination= divDestination.data('id');
                //    let continentDestination= divDestination.data('continent'); //continent stocké plus haut
                //    let paysDestination= divDestination.data('pays'); //pays stocké plus haut
                //    let regionDestination= divDestination.data('region'); //région stockée plus haut
                //    let descriptionDestination = divDestination.data('description'); //description stockée plus haut
                //    RemplirDivAgenceDestination(divDestination, {
                //        id: idDestination,
                //        Continent: continentDestination,
                //        Pays: paysDestination,
                //        Region: regionDestination,
                //        Description: descriptionDestination
                //    });
                //}


                ////fonction pour enregistrer la modification
                //function EnregistrerModification(divDestination) {
                //    let idDestination= divDestination.data('id');
                //    let continentDestination = divDestination.find('input').val();
                //    let paysDestination = divDestination.find('input').val();
                //    let regionDestination = divDestination.find('input').val();
                //    let descriptionDestination = divDestination.find('input').val();
                //    $.ajax({
                //        type: 'PUT',
                //        url: '/api/Destinations/' + idDestination,
                //        data: {
                //            id: idDestination,
                //            Continent: continentDestination,
                //            Pays: paysDestination,
                //            Region: regionDestination,
                //            Description: descriptionDestination
                //        },
                //        success: function () {
                //            RemplirDivDestination(divDestination, {
                //                id: idDestination,
                //                Continent: continentDestination,
                //                Pays: paysDestination,
                //                Region: regionDestination,
                //                Description: descriptionDestination
                //            });
                //        }
                //    });
                //}
                //$(document).ready(function () {
                //    LoadDestinations();
                //});
    </script>

</body>
</html>